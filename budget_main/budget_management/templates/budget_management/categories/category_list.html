{% extends "budget_core/layout/layout.html" %}
{% load money_tags %}
{% block title %}Manage — Money Manager{% endblock %}
{% block content %}

<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
  <div>
    <h1 class="text-2xl font-semibold">
      {% if type == 'budget' %}Budgets{% elif type == 'category' %}Categories{% else %}Accounts{% endif %}
    </h1>
    <p class="mt-1 text-xs sm:text-sm text-[var(--muted)]">
      Manage your {% if type == 'budget' %}budgets{% elif type == 'category' %}categories{% else %}accounts{% endif %} and add new ones.
    </p>
  </div>
</div>

<div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
  <!-- List column -->
  <div class="rounded-2xl p-4 sm:p-5 bg-[var(--card)] border border-[var(--border)] shadow-sm">
    <ul class="space-y-2">
      {% if type == 'budget' %}
        {% for b in budgets %}
          <li class="p-3 rounded-xl border border-[var(--border)] bg-[var(--bg)] flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div class="text-sm">
              <div class="font-medium">
                {{ b.category.name }}
              </div>
              <div class="text-[11px] text-[var(--muted)]">
                {{ b.month|date:"F Y" }} · RM {{ b.amount|floatformat:2 }}
              </div>
            </div>
            <div class="flex flex-wrap gap-2 text-xs sm:text-sm">
              <a href="{% url 'budget_edit' b.id %}"
                 class="px-3 py-1 rounded-full border border-sky-500/40 text-sky-600 dark:text-sky-300 hover:bg-sky-500/10">
                Edit
              </a>
              <a href="{% url 'budget_delete' b.id %}"
                 class="px-3 py-1 rounded-full border border-rose-500/40 text-rose-600 dark:text-rose-300 hover:bg-rose-500/10">
                Delete
              </a>
            </div>
          </li>
        {% empty %}
          <li class="text-[var(--muted)] text-sm">No budgets yet.</li>
        {% endfor %}

      {% elif type == 'category' %}
        {% for c in cats %}
          <li class="p-3 rounded-xl border border-[var(--border)] bg-[var(--bg)] flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div class="text-sm">
              <div class="font-medium">
                {{ c.name }}
              </div>
              <div class="text-[11px] text-[var(--muted)]">
                Type: {{ c.type|title }}
              </div>
            </div>
            <div class="flex flex-wrap gap-2 text-xs sm:text-sm">
              <a href="{% url 'category_edit' c.id %}"
                 class="px-3 py-1 rounded-full border border-sky-500/40 text-sky-600 dark:text-sky-300 hover:bg-sky-500/10">
                Edit
              </a>
              <a href="{% url 'category_delete' c.id %}"
                 class="px-3 py-1 rounded-full border border-rose-500/40 text-rose-600 dark:text-rose-300 hover:bg-rose-500/10">
                Delete
              </a>
            </div>
          </li>
        {% empty %}
          <li class="text-[var(--muted)] text-sm">No categories yet.</li>
        {% endfor %}

      {% else %} {# type == 'account' #}
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold text-sm uppercase tracking-wide text-[var(--muted)]">
            Accounts
          </h2>
          <a href="{% url 'account_transfer' %}"
             class="text-xs sm:text-sm text-sky-600 dark:text-sky-300 hover:underline">
            Transfer between accounts
          </a>
        </div>
        {% for a in accounts %}
          <li class="p-3 rounded-2xl border border-[var(--border)] bg-[var(--bg)] flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
              <div class="font-medium text-sm sm:text-base">
                {{ a.name }}
              </div>
              <div class="text-[11px] sm:text-xs text-[var(--muted)] mt-1">
                Opening: RM {{ a.balance|floatformat:2 }}
              </div>
            </div>
            <div class="text-right space-y-1">
              <div class="text-sm sm:text-base font-semibold">
                Live: RM {{ a.live_balance|floatformat:2 }}
              </div>
              <div class="flex flex-wrap justify-end gap-2 text-xs sm:text-sm">
                <a href="{% url 'account_edit' a.id %}"
                   class="px-3 py-1 rounded-full border border-sky-500/40 text-sky-600 dark:text-sky-300 hover:bg-sky-500/10">
                  Edit
                </a>
                <a href="{% url 'account_delete' a.id %}"
                   class="px-3 py-1 rounded-full border border-rose-500/40 text-rose-600 dark:text-rose-300 hover:bg-rose-500/10">
                  Delete
                </a>
              </div>
            </div>
          </li>
        {% empty %}
          <li class="text-[var(--muted)] text-sm">No accounts yet.</li>
        {% endfor %}
      {% endif %}
    </ul>
  </div>

  <!-- Add New column -->
  <div class="rounded-2xl p-4 sm:p-5 bg-[var(--card)] border border-[var(--border)] shadow-sm">
    <h2 class="font-semibold mb-3 text-sm uppercase tracking-wide text-[var(--muted)]">
      Add New
    </h2>

    <form method="post" class="space-y-3">
      {% csrf_token %}

      {% if type == 'budget' %}
        <div>
          <label for="category" class="block text-xs font-medium mb-1">Category</label>
          <select
            id="category"
            name="category"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
            <option value="">Select category</option>
            {% for c in categories %}
              <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="block text-xs font-medium mb-1">Month</label>
          <input
            type="date"
            name="month"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
        </div>

        <div>
          <label class="block text-xs font-medium mb-1">Amount (RM)</label>
          <input
            type="number"
            name="amount"
            placeholder="0.00"
            step="0.01"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500 no-scrollbar"
            required
          >
        </div>

      {% elif type == 'category' %}
        <div>
          <label class="block text-xs font-medium mb-1">Category Name</label>
          <input
            type="text"
            name="name"
            placeholder="e.g. Groceries"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
        </div>

        <div>
          <label class="block text-xs font-medium mb-1">Type</label>
          <input
            type="text"
            name="type"
            placeholder="income or expense"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
        </div>

      {% else %}
        <div>
          <label class="block text-xs font-medium mb-1">Account Name</label>
          <input
            type="text"
            name="name"
            placeholder="e.g. Maybank, Cash Wallet"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
        </div>

        <div>
          <label class="block text-xs font-medium mb-1">Opening Balance (RM)</label>
          <input
            type="number"
            name="balance"
            placeholder="0.00"
            step="0.01"
            class="w-full p-2 text-sm bg-[var(--input)] border border-[var(--border)] text-[var(--fg)] rounded-lg focus:outline-none focus:ring-1 focus:ring-emerald-500"
            required
          >
        </div>
      {% endif %}

      <button
        class="w-full sm:w-auto px-4 py-2 rounded-lg bg-emerald-500 text-black font-semibold text-sm mt-1 hover:bg-emerald-400 transition"
      >
        Save
      </button>
    </form>
  </div>
</div>

{% endblock %}
